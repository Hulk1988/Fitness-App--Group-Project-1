<!DOCTYPE html>
<html>
  <head>
    <title>Skunk Works Athletic</title>
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
      integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
      crossorigin="anonymous"
    />

    <link
      href="https://api.mapbox.com/mapbox-gl-js/v0.52.0/mapbox-gl.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.0.0/mapbox-gl-directions.css"
      type="text/css"
    />
    <link rel="stylesheet" href="assets/style/style.css" />
    <script
      src="https://code.jquery.com/jquery-3.3.1.min.js"
      integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
      crossorigin="anonymous"
    ></script>
    <script src="https://api.mapbox.com/mapbox.js/plugins/turf/v2.0.2/turf.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.8.0/firebase.js"></script>
    <script src="https://api.mapbox.com/mapbox-gl-js/v0.52.0/mapbox-gl.js"></script>
    <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.0.0/mapbox-gl-directions.js"></script>
  </head>

  <body>
    <div id="mapHandler">
        <div id="map" style="width: 450px; height: 450px;">
        </div>
    </div>
    <div id="distance" class="distance-container"></div>

    <div class="container" id="menu">
      <input
        id="basic"
        type="radio"
        name="rtoggle"
        value="basic"
        checked="checked"
      />
      <label for="basic">basic</label>
      <input id="streets" type="radio" name="rtoggle" value="streets" />
      <label for="streets">streets</label>
      <input id="bright" type="radio" name="rtoggle" value="bright" />
      <label for="bright">bright</label>
      <input id="light" type="radio" name="rtoggle" value="light" />
      <label for="light">light</label>
      <input id="dark" type="radio" name="rtoggle" value="dark" />
      <label for="dark">dark</label>
      <input id="satellite" type="radio" name="rtoggle" value="satellite" />
      <label for="satellite">satellite</label>
    </div>
    <br />
    <div>
      <div class="container" id="userInputContainer">
        <input type="text" id="location" placeholder="your location" />
        <button id="getWeather">Check Weather</button>
        <input type="text" id="userLocation" placeholder="your location" />
        <button id="saveWorkout">Save Workout</button>
      </div>
      <br />
      <div class="container" id="resultsHandler">
        <div>Temperature: <span id="temperature"></span></div>
        <div>Humidity: <span id="humidity"></span></div>
        <div>Visibility: <span id="visibility"></span></div>
        <div>Rain: <span id="rain"></span></div>
        <div>Wind: <span id="wind"></span></div>
      </div>
    </div>
    <!-- <script>
        mapboxgl.accessToken =
          "pk.eyJ1IjoiYW5kcmV3anRob21zZW4iLCJhIjoiY2pyNXFjam03MjlnNzQ0c2VzNjIzcWdhdyJ9.OgdsY8LjrFyxmcmOYXuAoA";
        var map = new mapboxgl.Map({
          container: "map",
          style: "mapbox://styles/mapbox/streets-v11"  
        });
      </script> -->
    <script>
      mapboxgl.accessToken =
        "pk.eyJ1IjoiYW5kcmV3anRob21zZW4iLCJhIjoiY2pyNXFjam03MjlnNzQ0c2VzNjIzcWdhdyJ9.OgdsY8LjrFyxmcmOYXuAoA";
      var map = new mapboxgl.Map({
        container: "map",
        style: "mapbox://styles/mapbox/basic-v9",
        zoom: 13,
        center: [4.899, 52.372]
      });

      map.addControl(
        new MapboxDirections({
          accessToken: mapboxgl.accessToken
        }),
        "top-left"
      );
      var layerList = document.getElementById("menu");
      var inputs = layerList.getElementsByTagName("input");

      function switchLayer(layer) {
        var layerId = layer.target.id;
        map.setStyle("mapbox://styles/mapbox/" + layerId + "-v9");
      }

      for (var i = 0; i < inputs.length; i++) {
        inputs[i].onclick = switchLayer;
      }
      var distanceContainer = document.getElementById("distance");

      // GeoJSON object to hold our measurement features
      var geojson = {
        type: "FeatureCollection",
        features: []
      };

      // Used to draw a line between points
      var linestring = {
        type: "Feature",
        geometry: {
          type: "LineString",
          coordinates: []
        }
      };

      map.on("load", function() {
        map.addSource("geojson", {
          type: "geojson",
          data: geojson
        });
        var mesaurePoints = "measure-points";
        // Add styles to the map
        map.addLayer({
          id: "measure-points",
          type: "circle",
          source: "geojson",
          paint: {
            "circle-radius": 5,
            "circle-color": "#000"
          },
          filter: ["in", "$type", "Point"]
        });
        map.addLayer({
          id: "measure-lines",
          type: "line",
          source: "geojson",
          layout: {
            "line-cap": "round",
            "line-join": "round"
          },
          paint: {
            "line-color": "#000",
            "line-width": 2.5
          },
          filter: ["in", "$type", "LineString"]
        });

        map.on("click", function(e) {
          var features = map.queryRenderedFeatures(e.point, {
            layers: ["measure-points"]
          });

          // Remove the linestring from the group
          // So we can redraw it based on the points collection
          if (geojson.features.length > 1) geojson.features.pop();

          // Clear the Distance container to populate it with a new value
          distanceContainer.innerHTML = "";

          // If a feature was clicked, remove it from the map
          if (features.length) {
            var id = features[0].properties.id;
            geojson.features = geojson.features.filter(function(point) {
              return point.properties.id !== id;
            });
          } else {
            var point = {
              type: "Feature",
              geometry: {
                type: "Point",
                coordinates: [e.lngLat.lng, e.lngLat.lat]
              },
              properties: {
                id: String(new Date().getTime())
              }
            };

            geojson.features.push(point);
          }

          if (geojson.features.length > 1) {
            linestring.geometry.coordinates = geojson.features.map(function(
              point
            ) {
              return point.geometry.coordinates;
            });

            geojson.features.push(linestring);

            // Populate the distanceContainer with total distance
            var value = document.createElement("pre");
            value.textContent =
              "Total distance: " +
              turf.lineDistance(linestring).toLocaleString() +
              "km";
            distanceContainer.appendChild(value);
          }

          map.getSource("geojson").setData(geojson);
        });
      });

      map.on("mousemove", function(e) {
        var features = map.queryRenderedFeatures(e.point, {
          layers: ["measure-points"]
        });
        // UI indicator for clicking/hovering a point on the map
        map.getCanvas().style.cursor = features.length
          ? "pointer"
          : "crosshair";
      });
    </script>

    <script src="assets/javascript/app.js" type="text/javascript"></script>
  </body>
</html>
